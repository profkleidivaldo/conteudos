<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cap√≠tulos - +Conte√∫do</title>
<style>
  body{margin:0;font-family:"Poppins",sans-serif;background:#0f172a;color:#f1f5f9}
  header{background:#0ea5e9;color:white;text-align:center;padding:16px 0;font-size:1.6rem;font-weight:700}
  main{max-width:900px;margin:36px auto;padding:0 20px}
  h1{text-align:center;color:#38bdf8;font-size:2rem;margin:0 0 8px}
  .subtitulo{text-align:center;color:#cbd5e1;margin-bottom:24px}
  .capitulos{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px}
  .capitulo{background:#1e293b;border-radius:10px;overflow:hidden;text-decoration:none;color:inherit;display:flex;flex-direction:column;transition:transform .18s,box-shadow .18s}
  .capitulo:hover{transform:scale(1.03);box-shadow:0 8px 20px rgba(56,189,248,0.18)}
  .capitulo img{width:100%;height:160px;object-fit:cover;filter:brightness(.86)}
  .capitulo h3{margin:0;padding:12px;text-align:center;border-top:2px solid #38bdf8;background:#0f172a;font-size:1rem}
  .mensagem{max-width:900px;margin:18px auto;padding:14px;border-radius:10px;background:#f8fafc;color:#0f172a}
  footer{text-align:center;padding:30px;color:#94a3b8}
  @media(max-width:600px){.capitulo img{height:130px}}
</style>
</head>
<body>
<header>üìö +Conte√∫do</header>

<main>
  <h1 id="titulo">T√≥pico</h1>
  <p class="subtitulo">Selecione um cap√≠tulo para abrir a aula</p>

  <div id="diagnostico" style="display:none" class="mensagem"></div>
  <div id="lista" class="capitulos" aria-live="polite"></div>
</main>

<footer>¬© +Conte√∫do ‚Äî Plataforma Educacional</footer>

<script>
/*
  index.html de t√≥pico ‚Äî detecta automaticamente o caminho da pasta no reposit√≥rio
  e lista todos os arquivos .html como cap√≠tulos (exceto index.html).
  CONFIGURE: usuario e repositorio abaixo (deixe conforme seu reposit√≥rio)
*/

const usuario = "profkleidivaldo";
const repositorio = "conteudos";
const repoFull = `${usuario}/${repositorio}`;
const listaDiv = document.getElementById('lista');
const tituloEl = document.getElementById('titulo');
const diag = document.getElementById('diagnostico');

/* Retira index.html e barras extras */
function cleanPath(p){
  if(!p) return "";
  return p.replace(/index\.html$/i,'').replace(/^\/|\/$/g,'');
}

/* Tenta derivar o caminho correto (p.ex. "1ano/matematica/geometria") de v√°rias formas */
function detectarCaminho(){
  let path = window.location.pathname || ""; // ex: /conteudos/1ano/matematica/geometria/index.html
  // remove query/hash
  path = path.split('?')[0].split('#')[0];

  // 1) se o path j√° cont√©m o nome do reposit√≥rio 'conteudos', usar o trecho ap√≥s ele
  const repoSegment = `/${repositorio}/`;
  if(path.toLowerCase().includes(repoSegment.toLowerCase())){
    const after = path.substring(path.toLowerCase().indexOf(repoSegment.toLowerCase()) + repoSegment.length);
    return cleanPath(after);
  }

  // 2) se o hostname √© <usuario>.github.io e o repo est√° em primeiro segmento (ex: /repo/...), remover o primeiro segmento possible
  const host = window.location.hostname || "";
  const segments = path.replace(/^\/+/,'').split('/');
  if(host.toLowerCase() === `${usuario.toLowerCase()}.github.io`){
    // path: /conteudos/1ano/...
    if(segments[0] === repositorio) return cleanPath(segments.slice(1).join('/'));
    // sometimes deployed at root of repo (no repo segment) => if path includes ano/..., return that
    return cleanPath(segments.join('/'));
  }

  // 3) fallback: se houver pattern like /<anything>/conteudos/... try to find 'conteudos' in segments
  const idxRepo = segments.findIndex(s => s.toLowerCase() === repositorio.toLowerCase());
  if(idxRepo !== -1){
    return cleanPath(segments.slice(idxRepo+1).join('/'));
  }

  // 4) fallback final: assume current folder is path without leading slash
  return cleanPath(segments.join('/'));
}

/* Monta URL da API GitHub para a pasta detectada */
function apiUrlPara(caminho){
  // se caminho vazio (n√£o esperado em t√≥pico), retorna root contents
  const caminhoSafe = caminho ? `/${caminho}` : "";
  return `https://api.github.com/repos/${repoFull}/contents${caminhoSafe}`;
}

function tituloFromPath(caminho){
  if(!caminho) return "T√≥pico";
  const parts = caminho.split('/');
  return parts[parts.length-1].replace(/[-_]/g,' ').replace(/\b\w/g, c => c.toUpperCase());
}

async function listarCapitulos(){
  listaDiv.innerHTML = "";
  diag.style.display = "none";
  const caminho = detectarCaminho(); // ex: "1ano/matematica/geometria"
  tituloEl.textContent = tituloFromPath(caminho);

  // diagnostic info (apenas para dev) ‚Äî se quiser esconder, comente a linha abaixo
  diag.style.display = "block";
  diag.innerHTML = `<strong>Diagn√≥stico:</strong><br>
    caminho detectado: <code>${caminho || '(vazio)'}</code><br>
    API solicitada: <code>${apiUrlPara(caminho)}</code>`;

  try{
    const res = await fetch(apiUrlPara(caminho), { headers: { "Accept": "application/vnd.github.v3+json" }});
    if(!res.ok){
      throw new Error(`GitHub API respondeu ${res.status} ${res.statusText}`);
    }
    const dados = await res.json();
    // filtra arquivos HTML, ignorando index.html
    const arquivos = dados.filter(f => f.type === 'file' && /\.html?$/i.test(f.name) && !/index\.html?$/i.test(f.name));

    if(!arquivos.length){
      listaDiv.innerHTML = `<p style="color:#cbd5e1">Nenhum cap√≠tulo (.html) encontrado nesta pasta.</p>`;
      return;
    }

    // ordenar: opcionalmente por nome
    arquivos.sort((a,b) => a.name.localeCompare(b.name, 'pt', { numeric: true }));

    for(let i=0;i<arquivos.length;i++){
      const arq = arquivos[i];
      const nome = arq.name.replace(/\.html?$/i,'').replace(/[-_]/g,' ');
      const card = document.createElement('a');
      card.className = 'capitulo';
      card.href = arq.name; // link relativo (abrir√° a p√°gina)
      card.target = '_blank';
      card.innerHTML = `
        <img src="https://picsum.photos/400/200?random=${Math.floor(Math.random()*100)}" alt="${nome}">
        <h3>${(i+1)}. ${nome}</h3>
      `;
      listaDiv.appendChild(card);
    }

    // esconder diagn√≥stico se tudo ok
    diag.style.display = "none";

  }catch(err){
    console.error("Erro ao listar cap√≠tulos:", err);
    diag.style.display = "block";
    diag.innerHTML += `<br><strong style="color:#fca5a5">Erro:</strong> ${err.message}`;
    listaDiv.innerHTML = `<p style="color:#fca5a5">‚ùå Erro ao carregar os cap√≠tulos. Veja o diagn√≥stico acima.</p>`;
  }
}

/* Executa */
listarCapitulos();
</script>
</body>
</html>
