<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Li√ß√£o+ ¬∑ Conte√∫dos (auto)</title>
<style>
  :root{--blue:#0e7490;--light:#e6f6fb;--muted:#667085}
  body{font-family:Inter,Segoe UI,Arial,sans-serif;margin:0;background:linear-gradient(180deg,#f8fbfd,#eef9ff);color:#123}
  header{background:linear-gradient(90deg,#0ea5a4,#06b6d4);color:white;padding:20px;text-align:center}
  header h1{margin:0;font-size:20px}
  main{padding:18px;max-width:1200px;margin:0 auto}
  .ano{margin:26px 0}
  .ano h2{margin:0 0 10px 0;padding-left:10px;border-left:6px solid var(--blue);color:var(--blue)}
  .materia{margin:12px 0 22px}
  .materia h3{margin:6px 0;color:#0b5660}
  .carrossel{display:flex;gap:12px;overflow-x:auto;padding:12px 6px}
  .carrossel::-webkit-scrollbar{height:10px}
  .card{flex:0 0 200px;background:white;border-radius:10px;box-shadow:0 6px 18px rgba(10,20,30,0.06);overflow:hidden;cursor:pointer;min-height:220px;display:flex;flex-direction:column}
  .thumb{height:120px;background:#fafafa;display:flex;align-items:center;justify-content:center}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .meta{padding:10px;flex:1;display:flex;flex-direction:column}
  .meta .title{font-weight:700;margin-bottom:6px;color:#0e5870;font-size:0.95rem}
  .meta .sub{flex:1;color:var(--muted);font-size:0.86rem}
  .meta .link{margin-top:8px;text-decoration:none;padding:8px 10px;border-radius:8px;background:var(--blue);color:white;display:inline-block;font-weight:700}
  .note{color:var(--muted);padding:14px;background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(10,20,30,0.04);margin-top:12px}
  footer{padding:18px;text-align:center;color:var(--muted);font-size:14px}
  @media (max-width:720px){
    .card{flex:0 0 160px}
    .thumb{height:100px}
  }
</style>
</head>
<body>
<header>
  <h1>üìö Li√ß√£o+ ‚Äî Cat√°logo autom√°tico (conte√∫dos/)</h1>
  <div style="font-size:13px;color:rgba(255,255,255,0.9);margin-top:6px">Busca autom√°tica por pastas e arquivos HTML dentro do reposit√≥rio GitHub</div>
</header>

<main id="main">
  <p id="status" style="text-align:center;padding:18px;color:var(--muted)">üîÑ Carregando pastas...</p>
  <div id="catalogo"></div>
</main>

<footer>¬© Li√ß√£o+ ‚Äî Plataforma baseada em GitHub Pages</footer>

<script>
/* ========== CONFIGURA√á√ÉO ========== */
const usuario = "profkleidivaldo"; // seu usu√°rio GitHub
const repositorio = "conteudos";   // nome do reposit√≥rio onde ficar√£o as pastas
const raizApi = `https://api.github.com/repos/${usuario}/${repositorio}/contents`; // sem barra final

/* ========== UTILIT√ÅRIOS ========== */
function safeText(s){
  if(!s) return '';
  // remove extens√µes como .html para exibir t√≠tulo
  return decodeURIComponent(s).replace(/\.html?$/i,'').replace(/[-_]/g,' ').replace(/\b([a-z])([A-Z])/g,'$1 $2');
}
function formatTitle(nome){
  // t√≠tulos leg√≠veis: '1ano' -> '1¬∫ Ano', 'linguaportuguesa' -> 'L√≠ngua Portuguesa'
  let t = nome.replace(/_/g,' ').replace(/-/g,' ');
  t = t.replace(/^(\d)ano$/i, (m, g1)=> `${g1}¬∫ Ano`);
  t = t.replace(/linguaportuguesa/i, 'L√≠ngua Portuguesa');
  t = t.replace(/matematica/i, 'Matem√°tica');
  t = t.replace(/historia/i, 'Hist√≥ria');
  t = t.replace(/geografia/i, 'Geografia');
  t = t.replace(/ciencias/i, 'Ci√™ncias');
  return t.charAt(0).toUpperCase() + t.slice(1);
}
function ghPagesUrl(parts){
  // parts: array de segmentos do caminho (j√° sem encoding)
  // deve retornar a URL p√∫blica do GitHub Pages com encoding por segmento
  const encoded = parts.map(p => encodeURIComponent(p));
  return `https://${usuario}.github.io/${repositorio}/${encoded.join('/')}`;
}

/* ========== FUN√á√ïES DE API ========== */
async function listarDiretorio(apiUrl){
  // espera uma URL do tipo https://api.github.com/repos/user/repo/contents/path
  try{
    const res = await fetch(apiUrl);
    if(!res.ok){
      console.warn('listarDiretorio: resposta n√£o OK', apiUrl, res.status);
      return [];
    }
    const dados = await res.json();
    // filtra apenas diret√≥rios e arquivos
    return Array.isArray(dados) ? dados : [];
  }catch(err){
    console.error('Erro fetch listarDiretorio', err);
    return [];
  }
}

/* ========== L√ìGICA PRINCIPAL ========== */
async function montarCatalogo(){
  const status = document.getElementById('status');
  const catalogo = document.getElementById('catalogo');
  catalogo.innerHTML = '';
  status.textContent = 'üîç Buscando pastas na raiz do reposit√≥rio...';

  // 1) listar pastas na raiz (espera pastas: 1ano, 2ano, ...)
  const raiz = await listarDiretorio(raizApi);
  const pastasAnos = raiz.filter(x => x.type === 'dir');

  if(pastasAnos.length === 0){
    status.innerHTML = '‚ö†Ô∏è N√£o foram encontradas pastas no reposit√≥rio. Verifique se voc√™ tem pastas como <code>1ano</code>, <code>2ano</code>, etc.';
    return;
  }
  status.textContent = '';

  // percorre cada ano
  for(const ano of pastasAnos){
    const anoDiv = document.createElement('div');
    anoDiv.className = 'ano';
    anoDiv.innerHTML = `<h2>${formatTitle(ano.name)}</h2>`;
    catalogo.appendChild(anoDiv);

    // 2) listar mat√©rias dentro do ano
    const materias = (await listarDiretorio(ano.url)).filter(x=>x.type === 'dir');

    if(materias.length === 0){
      const note = document.createElement('div'); note.className='note';
      note.textContent = 'Nenhuma mat√©ria encontrada dentro dessa pasta de ano.';
      anoDiv.appendChild(note);
      continue;
    }

    // para cada mat√©ria
    for(const materia of materias){
      const matDiv = document.createElement('div');
      matDiv.className = 'materia';
      matDiv.innerHTML = `<h3>${formatTitle(materia.name)}</h3>`;
      anoDiv.appendChild(matDiv);

      const carrossel = document.createElement('div');
      carrossel.className = 'carrossel';
      matDiv.appendChild(carrossel);

      // 3) listar t√≥picos (subpastas) dentro da mat√©ria
      const topicos = (await listarDiretorio(materia.url)).filter(x=>x.type === 'dir');

      // se n√£o h√° subpastas, talvez o professor colocou arquivos HTML direto na mat√©ria -> listar arquivos HTML aqui
      if(topicos.length === 0){
        const arquivos = (await listarDiretorio(materia.url)).filter(x=>x.type === 'file' && /\.html?$/i.test(x.name));
        if(arquivos.length === 0){
          const p = document.createElement('div'); p.className='note'; p.textContent='Nenhum t√≥pico nem arquivos HTML encontrados nesta mat√©ria.';
          matDiv.appendChild(p);
        } else {
          // criar cards para cada arquivo HTML encontrado diretamente na mat√©ria
          for(const arquivo of arquivos){
            const title = safeText(arquivo.name);
            const url = ghPagesUrl([ano.name, materia.name, arquivo.name]);
            const card = criarCard(title, '', url);
            carrossel.appendChild(card);
          }
        }
        continue;
      }

      // 4) para cada t√≥pico, listar arquivos .html dentro do t√≥pico
      for(const topico of topicos){
        const arquivos = (await listarDiretorio(topico.url)).filter(x=>x.type === 'file' && /\.html?$/i.test(x.name));

        if(arquivos.length === 0){
          // se n√£o h√° arquivos .html, mostrar card indicando vazio
          const card = document.createElement('div'); card.className='card'; card.innerHTML = `<div class="thumb"><img src="https://via.placeholder.com/400x240?text=Sem+Aulas"></div>
            <div class="meta"><div class="title">${formatTitle(topico.name)}</div><div class="sub">Nenhuma aula HTML encontrada neste t√≥pico.</div></div>`;
          carrossel.appendChild(card);
          continue;
        }

        // Se existir index.html, coloc√°-lo primeiro
        arquivos.sort((a,b)=>{
          if(/index\.html?$/i.test(a.name)) return -1;
          if(/index\.html?$/i.test(b.name)) return 1;
          return a.name.localeCompare(b.name);
        });

        // para cada arquivo .html no t√≥pico, criar um card (um "livro" por aula)
        for(const arquivo of arquivos){
          const title = safeText(arquivo.name);
          const url = ghPagesUrl([ano.name, materia.name, topico.name, arquivo.name]);
          const thumb = buscarThumbNoArquivo(arquivo); // placeholder function (podemos melhorar)
          const card = criarCard(title, thumb, url, topico.name);
          carrossel.appendChild(card);
        }
      } // fim topicos
    } // fim materias
  } // fim anos

  // fim montagem
  if(catalogo.children.length === 0) status.textContent = '‚ö†Ô∏è Nenhum conte√∫do exibido.';
}

/* cria um card DOM (elemento) */
function criarCard(title, thumbUrl, link, topicName){
  const a = document.createElement('a');
  a.className = 'card';
  a.href = link;
  a.target = '_blank';
  const imgUrl = thumbUrl || `https://picsum.photos/400/240?random=${Math.floor(Math.random()*100)}`;
  a.innerHTML = `<div class="thumb"><img src="${imgUrl}" alt="${escapeHtml(title)}"></div>
    <div class="meta"><div class="title">${escapeHtml(title)}</div><div class="sub">${escapeHtml(topicName?formatTitle(topicName):'Aula')}</div>
    <a class="link" href="${link}" target="_blank" style="display:inline-block;margin-top:8px;background:${'var(--blue)'};color:#fff;border-radius:8px;padding:6px 8px;text-decoration:none">Abrir</a>
    </div>`;
  return a;
}

function escapeHtml(str){ return (str||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

/* buscarThumbNoArquivo: placeholder - atualmente n√£o baixa o arquivo para extrair imagem,
   mas poder√≠amos buscar um arquivo chamado 'cover.jpg' ou 'thumb.png' na mesma pasta.
   Para j√°, retorna null para usar imagem aleat√≥ria/picsum.
*/
function buscarThumbNoArquivo(fileObj){
  return null;
}

/* ========== inicializa√ß√£o ========== */
montarCatalogo();
</script>
</body>
</html>
